# Pull Request Guidelines for Claude Code

## PR Title Format

Follow Conventional Commits specification:

```
<type>(<scope>): <description>
```

### Types

- `feat` - new feature for users
- `fix` - bug fix
- `refactor` - code change without features or fixes
- `perf` - performance improvement
- `docs` - documentation only
- `test` - adding or updating tests
- `build` - build system or dependencies
- `ci` - CI/CD configuration
- `chore` - other tasks

### Scope Examples

- `core` - changes in @tschannel/core
- `iframe-channel` - changes in @tschannel/iframe-channel
- `pubsub-channel` - changes in @tschannel/pubsub-channel
- `dev-app` - changes in demo application
- `deps` - dependency updates
- `config` - configuration changes

### Good PR Title Examples

- ‚úÖ `feat(core): add middleware support for request interception`
- ‚úÖ `fix(iframe-channel): prevent memory leak on destroy`
- ‚úÖ `refactor(pubsub-channel): simplify event handling logic`
- ‚úÖ `perf(core): optimize message serialization`
- ‚úÖ `docs(readme): add installation instructions for monorepo`
- ‚úÖ `test(core): add integration tests for Bridge class`

### Bad PR Title Examples

- ‚ùå `Update code`
- ‚ùå `Fix bug`
- ‚ùå `WIP: changes`
- ‚ùå `merge main into feature`
- ‚ùå `Update README.md`

## PR Description Template

```markdown
## Summary

Brief description of what and why (1-3 sentences).

## Changes

- Bullet list of key changes
- What files/modules were affected
- What functionality was added/modified/removed

## Breaking Changes (if any)

- List any breaking changes
- Migration guide for users

## Test Plan

- [ ] Unit tests added/updated
- [ ] Integration tests pass
- [ ] Manual testing performed
- [ ] All CI checks pass (lint, typecheck, build, test)

## Related Issues

Closes #123
Refs #456

---

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

## PR Requirements Checklist

### 1. Clear Description

- Includes a clear description of the changes as guided by CLAUDE.md
- Explains **why** the change is needed, not just **what** was changed

### 2. References

- References any related issues (if exists) that Claude Code is addressing
- Uses `Closes #123` for issues that will be closed
- Uses `Refs #456` for related issues

### 3. Tests

- Ensures all tests pass for code generated by Claude Code
- Adds new tests for new functionality
- Updates existing tests if behavior changed

### 4. Focus

- Keeps PRs focused on a single concern as specified in CLAUDE.md
- Avoids mixing unrelated changes
- Splits large changes into multiple PRs if needed

### 5. Commit Messages

- Uses conventional commit format
- Each commit is atomic and meaningful
- Commit messages explain the "why"

### 6. Code Quality

- Follows `CODESTYLE.md` conventions
- No magic numbers (extracted to constants)
- Proper naming (T for types, I for interfaces, PascalCase for classes)
- All files and functions have proper documentation

### 7. Changesets

- Includes changeset file (`.changeset/*.md`) for package changes
- Changeset describes user-facing changes
- Correct version bump type (patch/minor/major)

## Example PR Description

```markdown
## Summary

Add retry mechanism to IframeChannel to handle transient postMessage failures. This improves reliability when the iframe is not fully loaded yet.

## Changes

- Added `RetryConfig` type to configure retry behavior
- Implemented exponential backoff strategy in `IframeChannel.send()`
- Added `maxRetries` and `retryDelay` options to `TIframeChannelConfig`
- Updated tests to cover retry scenarios
- Added documentation for retry configuration

## Breaking Changes

None. The retry feature is opt-in via config.

## Test Plan

- [x] Unit tests added for retry logic
- [x] Integration tests pass
- [x] Manual testing with slow-loading iframe
- [x] All CI checks pass

## Related Issues

Closes #42 - IframeChannel fails with fast consecutive messages
Refs #38 - Improve channel reliability

---

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

## Before Submitting

Run all checks from root:

```bash
pnpm lint          # Check code style
pnpm typecheck     # Check types
pnpm test          # Run tests
pnpm build         # Verify build works
```

All checks must pass before the PR can be merged.

## PR Review Process

1. **Automated checks** - CI runs all checks
2. **Code review** - Maintainer reviews code and design
3. **Changeset verification** - Ensure changeset is present and correct
4. **Approval** - PR is approved
5. **Merge** - PR is merged to main branch
6. **Release** - Changesets creates release PR when ready
